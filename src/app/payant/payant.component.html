<div class="container">
  
  <header>
    <h1>Formation Live (Firebase)</h1>
    <div class="role-switcher">
      R√¥le actuel : <strong>{{ userRole }}</strong>
      <button (click)="userRole = userRole === 'MENTOR' ? 'ELEVE' : 'MENTOR'" class="btn-xs">Changer (Dev)</button>
    </div>
  </header>

  <div *ngIf="etape === 'CONFIG'" class="card">
    <h2>Cr√©er une session</h2>
    <select [(ngModel)]="config.tarifType">
      <option value="FIXE">Prix Fixe</option>
      <option value="HEURE">Prix / Heure</option>
    </select>
    <input type="number" [(ngModel)]="config.prix" placeholder="Montant">
    <input type="text" [(ngModel)]="config.sujet" placeholder="Sujet">
    <button (click)="creerOffre()" class="btn-primary">Cr√©er Offre & Attendre</button>
  </div>

  <div *ngIf="etape === 'ATTENTE'" class="card">
    <h3>En attente d'un √©l√®ve...</h3>
    <p>ID Contrat Firestore : <small>{{ currentContractId }}</small></p>
    <hr>
    <p><em>(Simulation √âl√®ve)</em></p>
    <button (click)="rejoindreSession()" class="btn-secondary">Simuler Arriv√©e √âl√®ve</button>
  </div>

  <div *ngIf="etape === 'CHAT'" class="chat-container">
    <div class="chat-header">
      Negociation pour : {{ contratData?.sujet }} ({{ contratData?.prix }}‚Ç¨)
    </div>
    
    <div class="messages-list">
      <div *ngFor="let msg of messages$ | async" 
           [class]="'msg ' + (msg.user === userRole ? 'me' : 'other')">
        <strong>{{ msg.user }}:</strong> {{ msg.text }}
      </div>
    </div>

    <div class="chat-input">
      <input [(ngModel)]="nouveauMessage" (keyup.enter)="envoyerMessage()" placeholder="Message...">
      <button (click)="envoyerMessage()">Envoyer</button>
    </div>

    <div class="actions" *ngIf="userRole === 'MENTOR'">
      <button (click)="lancerContrat()" class="btn-success">D√©marrer le Contrat</button>
    </div>
    <div *ngIf="userRole === 'ELEVE'" class="info-wait">
      Attendez que le mentor d√©marre le contrat...
    </div>
  </div>

  <div *ngIf="etape === 'ACTIF'" class="card active">
    <h2>üî¥ En Direct</h2>
    <div *ngIf="config.tarifType === 'HEURE'" class="timer">{{ tempsEcoule }}</div>
    <p>Le contrat est s√©curis√© sur Firestore.</p>
    
    <button *ngIf="userRole === 'MENTOR'" (click)="stopperContrat()" class="btn-danger">Terminer la Formation</button>
  </div>

  <div *ngIf="etape === 'FIN'" class="card">
    <h2>Termin√© !</h2>
    <h1 class="price">{{ montantFinal }} ‚Ç¨</h1>
    <p>Montant calcul√© et synchronis√©.</p>
    
    <div class="stars">
      <span>Notez l'exp√©rience :</span>
      <button (click)="envoyerFeedback(5)">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</button>
    </div>
  </div>

</div>
